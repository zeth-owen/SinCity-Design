{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useParams,useHistory}from'react-router-dom';import StarRating from'../websites/StarRating';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AppShowPage=()=>{const{id}=useParams();const history=useHistory();const[template,setTemplate]=useState(null);const[comments,setComments]=useState([]);const[newComment,setNewComment]=useState('');const[rating,setRating]=useState(0);const[accessDenied,setAccessDenied]=useState(false);useEffect(()=>{const fetchApp=async()=>{try{const response=await fetch(`https://api.envato.com/v3/market/catalog/item?id=${id}`,{headers:{'Authorization':`Bearer ${process.env.REACT_APP_ENVATO_API_KEY}`}});if(!response.ok){throw new Error('Failed to fetch app');}const data=await response.json();console.log('API Response:',data);console.log('Fetched app:',data);const app=data;if(app){setTemplate(app);}else{console.warn(`No app found with ID: ${id}`);}}catch(error){console.error('Error fetching app:',error);}};const fetchComments=async()=>{try{console.log(`Fetching comments from http://localhost:4000/comments/${id}`);const response=await fetch(`http://localhost:4000/comments/${id}`);if(!response.ok){console.error('Failed to fetch comments:',response.status,response.statusText);throw new Error('Failed to fetch comments');}const data=await response.json();console.log('Comments fetched:',data);setComments(data);}catch(error){console.error('Error fetching comments:',error);}};fetchApp();fetchComments();},[id]);const handleCommentSubmit=async e=>{e.preventDefault();const token=localStorage.getItem('token');if(!token){setAccessDenied(true);return;}try{const response=await fetch(`http://localhost:4000/templates/${id}/comments`,{method:'POST',headers:{'Content-Type':'application/json','Authorization':`Bearer ${token}`},body:JSON.stringify({comment:newComment,rating})});if(!response.ok){throw new Error('Failed to submit comment');}const data=await response.json();setComments(prevComments=>[...prevComments,data]);setNewComment('');setRating(0);setAccessDenied(false);}catch(error){console.error('Error submitting comment:',error);}};const navigateBack=()=>{history.push('/apps');};const averageRating=comments.length>0?comments.reduce((total,comment)=>total+comment.rating,0)/comments.length:0;return/*#__PURE__*/_jsx(\"div\",{className:\"show-page-container\",children:template?/*#__PURE__*/_jsxs(\"div\",{className:\"show-page-content\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"page-title\",children:template.name}),template.previews&&template.previews.landscape_preview&&/*#__PURE__*/_jsx(\"img\",{src:template.previews.landscape_preview.landscape_url,alt:template.name,className:\"template-image\"}),template.previews&&template.previews.live_site&&template.previews.live_site.href?/*#__PURE__*/_jsxs(\"p\",{className:\"live-site\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Live Site: \"}),/*#__PURE__*/_jsx(\"a\",{href:`https://themeforest.net${template.previews.live_site.href}`,target:\"_blank\",rel:\"noopener noreferrer\",className:\"live-site-link\",children:\"View Live Preview\"})]}):/*#__PURE__*/_jsx(\"p\",{children:\"No live site available\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Category: \",template.classification]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Designer: \",template.author_username]}),/*#__PURE__*/_jsx(StarRating,{rating:rating,onRating:rate=>setRating(rate)}),/*#__PURE__*/_jsxs(\"p\",{className:\"average-rating\",children:[\"Average Rating: \",averageRating.toFixed(1)]}),/*#__PURE__*/_jsxs(\"section\",{className:\"comments-section\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Comments\"}),accessDenied&&/*#__PURE__*/_jsx(\"p\",{className:\"error-message\",children:\"Access Denied: You must be logged in to submit a comment.\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleCommentSubmit,className:\"comment-form\",children:[/*#__PURE__*/_jsx(\"textarea\",{value:newComment,onChange:e=>setNewComment(e.target.value),placeholder:\"Add a comment\",className:\"comment-textarea\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"button\",{className:\"comment-submit-button\",type:\"submit\",children:\"Submit\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"comments-list\",children:comments.map(comment=>/*#__PURE__*/_jsxs(\"div\",{className:\"comment-item\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"comment-name\",children:[comment.first_name,\" \",comment.last_name,\":\"]}),/*#__PURE__*/_jsx(\"p\",{className:\"comment-text\",children:comment.comment})]},comment.id))})]}),/*#__PURE__*/_jsx(\"button\",{className:\"back-button\",onClick:navigateBack,children:\"Back to Apps\"})]}):/*#__PURE__*/_jsx(\"p\",{children:\"Loading...\"})});};export default AppShowPage;","map":{"version":3,"names":["React","useState","useEffect","useParams","useHistory","StarRating","jsx","_jsx","jsxs","_jsxs","AppShowPage","id","history","template","setTemplate","comments","setComments","newComment","setNewComment","rating","setRating","accessDenied","setAccessDenied","fetchApp","response","fetch","headers","process","env","REACT_APP_ENVATO_API_KEY","ok","Error","data","json","console","log","app","warn","error","fetchComments","status","statusText","handleCommentSubmit","e","preventDefault","token","localStorage","getItem","method","body","JSON","stringify","comment","prevComments","navigateBack","push","averageRating","length","reduce","total","className","children","name","previews","landscape_preview","src","landscape_url","alt","live_site","href","target","rel","classification","author_username","onRating","rate","toFixed","onSubmit","value","onChange","placeholder","type","map","first_name","last_name","onClick"],"sources":["/Users/zeththomas/Documents/sincity-media/client/src/apps/AppShowPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useParams, useHistory } from 'react-router-dom';\nimport StarRating from '../websites/StarRating';\n\nconst AppShowPage = () => {\n  const { id } = useParams();\n  const history = useHistory();\n  const [template, setTemplate] = useState(null);\n  const [comments, setComments] = useState([]);\n  const [newComment, setNewComment] = useState('');\n  const [rating, setRating] = useState(0);\n  const [accessDenied, setAccessDenied] = useState(false);\n\n  useEffect(() => {\n    const fetchApp = async () => {\n      try {\n        const response = await fetch(`https://api.envato.com/v3/market/catalog/item?id=${id}`, {\n          headers: {\n            'Authorization': `Bearer ${process.env.REACT_APP_ENVATO_API_KEY}`\n          }\n        });\n\n        if (!response.ok) {\n          throw new Error('Failed to fetch app');\n        }\n\n        const data = await response.json();\n        console.log('API Response:', data);\n        console.log('Fetched app:', data);\n        const app = data;\n       \n        if (app) {\n          setTemplate(app);\n        } else {\n          console.warn(`No app found with ID: ${id}`);\n        }\n      } catch (error) {\n        console.error('Error fetching app:', error);\n      }\n    };\n\n    const fetchComments = async () => {\n      try {\n        console.log(`Fetching comments from http://localhost:4000/comments/${id}`);\n        const response = await fetch(`http://localhost:4000/comments/${id}`);\n        if (!response.ok) {\n          console.error('Failed to fetch comments:', response.status, response.statusText);\n          throw new Error('Failed to fetch comments');\n        }\n        const data = await response.json();\n        console.log('Comments fetched:', data);\n        setComments(data);\n      } catch (error) {\n        console.error('Error fetching comments:', error);\n      }\n    };\n    \n\n    fetchApp();\n    fetchComments();\n  }, [id]);\n\n  const handleCommentSubmit = async (e) => {\n    e.preventDefault();\n\n    const token = localStorage.getItem('token');\n    if (!token) {\n      setAccessDenied(true);\n      return;\n    }\n\n    try {\n      const response = await fetch(`http://localhost:4000/templates/${id}/comments`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify({ comment: newComment, rating })\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to submit comment');\n      }\n\n      const data = await response.json();\n      setComments((prevComments) => [...prevComments, data]);\n      setNewComment('');\n      setRating(0);\n      setAccessDenied(false); \n    } catch (error) {\n      console.error('Error submitting comment:', error);\n    }\n  };\n\n  const navigateBack = () => {\n    history.push('/apps'); \n  };\n\n  const averageRating = comments.length > 0\n    ? comments.reduce((total, comment) => total + comment.rating, 0) / comments.length\n    : 0;\n\n  return (\n    <div className=\"show-page-container\">\n      {template ? (\n        <div className=\"show-page-content\">\n          <h1 className=\"page-title\">{template.name}</h1>\n          {template.previews && template.previews.landscape_preview && (\n            <img\n              src={template.previews.landscape_preview.landscape_url}\n              alt={template.name}\n              className=\"template-image\"\n            />\n          )}\n          {template.previews && template.previews.live_site && template.previews.live_site.href ? (\n            <p className=\"live-site\">\n              <strong>Live Site: </strong>\n              <a\n                href={`https://themeforest.net${template.previews.live_site.href}`}\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className=\"live-site-link\"\n              >\n                View Live Preview\n              </a>\n            </p>\n          ) : (\n            <p>No live site available</p>\n          )}\n          <p>Category: {template.classification}</p>\n          <p>Designer: {template.author_username}</p>\n\n          <StarRating rating={rating} onRating={(rate) => setRating(rate)} />\n          <p className=\"average-rating\">Average Rating: {averageRating.toFixed(1)}</p>\n\n          <section className=\"comments-section\">\n            <h2>Comments</h2>\n            {accessDenied && <p className=\"error-message\">Access Denied: You must be logged in to submit a comment.</p>}\n            <form onSubmit={handleCommentSubmit} className=\"comment-form\">\n              <textarea\n                value={newComment}\n                onChange={(e) => setNewComment(e.target.value)}\n                placeholder=\"Add a comment\"\n                className=\"comment-textarea\"\n              ></textarea><br/>\n              <button className=\"comment-submit-button\" type=\"submit\">Submit</button>\n            </form>\n            <div className=\"comments-list\">\n              {comments.map((comment) => (\n                <div key={comment.id} className=\"comment-item\">\n                  <p className=\"comment-name\">{comment.first_name} {comment.last_name}:</p>\n                  <p className=\"comment-text\">{comment.comment}</p>\n                </div>\n              ))}\n            </div>\n          </section>\n          <button className=\"back-button\" onClick={navigateBack}>Back to Apps</button>\n        </div>\n      ) : (\n        <p>Loading...</p>\n      )}\n    </div>\n  );\n};\n\nexport default AppShowPage;\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}