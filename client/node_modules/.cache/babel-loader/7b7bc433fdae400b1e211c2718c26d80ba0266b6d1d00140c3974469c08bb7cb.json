{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useParams,useHistory}from'react-router-dom';import StarRating from'../websites/StarRating';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const PhotoShowPage=()=>{const{id}=useParams();const history=useHistory();const[photo,setPhoto]=useState(null);const[comments,setComments]=useState([]);const[newComment,setNewComment]=useState('');const[rating,setRating]=useState(0);const[accessDenied,setAccessDenied]=useState(false);const[loading,setLoading]=useState(false);const[error,setError]=useState(null);useEffect(()=>{const fetchPhoto=async()=>{setLoading(true);setError(null);try{const response=await fetch(`https://api.unsplash.com/photos/${id}`,{headers:{Authorization:`Client-ID ${process.env.ACCESS_KEY}`}});if(!response.ok){throw new Error(`Failed to fetch photo: ${response.status} ${response.statusText}`);}const data=await response.json();setPhoto(data);}catch(error){console.error('Error fetching photo:',error);setError('Error fetching photo. Please try again later.');}finally{setLoading(false);}};const fetchComments=async()=>{try{const response=await fetch(`http://localhost:4000/comments?photoId=${id}`);if(!response.ok){throw new Error('Failed to fetch comments');}const data=await response.json();setComments(data);}catch(error){console.error('Error fetching comments:',error);}};fetchPhoto();fetchComments();},[id]);const handleCommentSubmit=async e=>{e.preventDefault();const token=localStorage.getItem('token');if(!token){setAccessDenied(true);return;}try{const response=await fetch(`http://localhost:4000/photos/${id}/comments`,{method:'POST',headers:{'Content-Type':'application/json','Authorization':`Bearer ${token}`},body:JSON.stringify({comment:newComment,rating})});if(!response.ok){throw new Error('Failed to submit comment');}const data=await response.json();setComments(prevComments=>[...prevComments,data]);setNewComment('');setRating(0);setAccessDenied(false);// Reset access denied state\n}catch(error){console.error('Error submitting comment:',error);}};const navigateBack=()=>{history.push('/photos');// Adjust the path as needed\n};return/*#__PURE__*/_jsx(\"div\",{className:\"show-page-container\",children:photo?/*#__PURE__*/_jsxs(\"div\",{className:\"show-page-content\",children:[/*#__PURE__*/_jsx(\"h1\",{children:photo.alt_description}),/*#__PURE__*/_jsx(\"img\",{src:photo.urls.regular,alt:photo.alt_description}),/*#__PURE__*/_jsx(StarRating,{rating:rating,onRating:rate=>setRating(rate)}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Average Rating: \",rating]}),/*#__PURE__*/_jsxs(\"section\",{className:\"comments-section\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Comments\"}),accessDenied&&/*#__PURE__*/_jsx(\"p\",{className:\"error-message\",children:\"Access Denied: You must be logged in to submit a comment.\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleCommentSubmit,children:[/*#__PURE__*/_jsx(\"textarea\",{value:newComment,onChange:e=>setNewComment(e.target.value),placeholder:\"Add a comment\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Submit\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"comments-list\",children:comments.map(comment=>/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"p\",{children:comment.comment})},comment.id))})]}),/*#__PURE__*/_jsx(\"button\",{className:\"back-button\",onClick:navigateBack,children:\"Back to Photos\"})]}):loading?/*#__PURE__*/_jsx(\"p\",{children:\"Loading...\"}):/*#__PURE__*/_jsx(\"p\",{children:error||'Photo not found.'})});};export default PhotoShowPage;","map":{"version":3,"names":["React","useState","useEffect","useParams","useHistory","StarRating","jsx","_jsx","jsxs","_jsxs","PhotoShowPage","id","history","photo","setPhoto","comments","setComments","newComment","setNewComment","rating","setRating","accessDenied","setAccessDenied","loading","setLoading","error","setError","fetchPhoto","response","fetch","headers","Authorization","process","env","ACCESS_KEY","ok","Error","status","statusText","data","json","console","fetchComments","handleCommentSubmit","e","preventDefault","token","localStorage","getItem","method","body","JSON","stringify","comment","prevComments","navigateBack","push","className","children","alt_description","src","urls","regular","alt","onRating","rate","onSubmit","value","onChange","target","placeholder","type","map","onClick"],"sources":["/Users/zeththomas/Documents/sincity-media/client/src/photography/PhotoShowPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useParams, useHistory } from 'react-router-dom';\nimport StarRating from '../websites/StarRating';\n\nconst PhotoShowPage = () => {\n  const { id } = useParams();\n  const history = useHistory();\n  const [photo, setPhoto] = useState(null);\n  const [comments, setComments] = useState([]);\n  const [newComment, setNewComment] = useState('');\n  const [rating, setRating] = useState(0);\n  const [accessDenied, setAccessDenied] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    const fetchPhoto = async () => {\n      setLoading(true);\n      setError(null);\n\n      try {\n        const response = await fetch(`https://api.unsplash.com/photos/${id}`, {\n          headers: {\n            Authorization: `Client-ID ${process.env.ACCESS_KEY}`\n          }\n        });\n\n        if (!response.ok) {\n          throw new Error(`Failed to fetch photo: ${response.status} ${response.statusText}`);\n        }\n\n        const data = await response.json();\n        setPhoto(data);\n      } catch (error) {\n        console.error('Error fetching photo:', error);\n        setError('Error fetching photo. Please try again later.');\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    const fetchComments = async () => {\n      try {\n        const response = await fetch(`http://localhost:4000/comments?photoId=${id}`);\n        if (!response.ok) {\n          throw new Error('Failed to fetch comments');\n        }\n        const data = await response.json();\n        setComments(data);\n      } catch (error) {\n        console.error('Error fetching comments:', error);\n      }\n    };\n\n    fetchPhoto();\n    fetchComments();\n  }, [id]);\n\n  const handleCommentSubmit = async (e) => {\n    e.preventDefault();\n\n    const token = localStorage.getItem('token');\n    if (!token) {\n      setAccessDenied(true);\n      return;\n    }\n\n    try {\n      const response = await fetch(`http://localhost:4000/photos/${id}/comments`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify({ comment: newComment, rating })\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to submit comment');\n      }\n\n      const data = await response.json();\n      setComments((prevComments) => [...prevComments, data]);\n      setNewComment('');\n      setRating(0);\n      setAccessDenied(false); // Reset access denied state\n    } catch (error) {\n      console.error('Error submitting comment:', error);\n    }\n  };\n\n  const navigateBack = () => {\n    history.push('/photos'); // Adjust the path as needed\n  };\n\n  return (\n    <div className=\"show-page-container\">\n      {photo ? (\n        <div className=\"show-page-content\">\n          <h1>{photo.alt_description}</h1>\n          <img src={photo.urls.regular} alt={photo.alt_description} />\n\n          <StarRating rating={rating} onRating={(rate) => setRating(rate)} />\n          <p>Average Rating: {rating}</p>\n\n          <section className=\"comments-section\">\n            <h2>Comments</h2>\n            {accessDenied && <p className=\"error-message\">Access Denied: You must be logged in to submit a comment.</p>}\n            <form onSubmit={handleCommentSubmit}>\n              <textarea\n                value={newComment}\n                onChange={(e) => setNewComment(e.target.value)}\n                placeholder=\"Add a comment\"\n              ></textarea>\n              <button type=\"submit\">Submit</button>\n            </form>\n            <div className=\"comments-list\">\n              {comments.map((comment) => (\n                <div key={comment.id}>\n                  <p>{comment.comment}</p>\n                </div>\n              ))}\n            </div>\n          </section>\n\n          {/* \"Back to Photos\" button */}\n          <button className=\"back-button\" onClick={navigateBack}>Back to Photos</button>\n        </div>\n      ) : loading ? (\n        <p>Loading...</p>\n      ) : (\n        <p>{error || 'Photo not found.'}</p>\n      )}\n    </div>\n  );\n};\n\nexport default PhotoShowPage;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}